(()=>{"use strict";var t={147:t=>{t.exports=require("fs")},655:t=>{t.exports=require("v8")}},e={};function o(r){var i=e[r];if(void 0!==i)return i.exports;var n=e[r]={exports:{}};return t[r](n,n.exports,o),n.exports}o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var r in e)o.o(e,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{const t=require("express");var e=o.n(t),r=function(t,e,o,r){return new(o||(o=Promise))((function(i,n){function s(t){try{c(r.next(t))}catch(t){n(t)}}function d(t){try{c(r.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(s,d)}c((r=r.apply(t,e||[])).next())}))};const i=o(147),{DefaultDeserializer:n}=o(655);class s{constructor(t){this.archivo=t}save(t){return r(this,void 0,void 0,(function*(){try{const e=yield this.getAll();let o;return o=e.length?e.slice(-1)[0].id+1:1,t.id=o,t.precio=parseInt(t.precio),t.timestamp=Date.now(),t.stock=parseInt(t.stock),e.push(t),yield i.promises.writeFile(this.archivo,JSON.stringify(e)),t}catch(t){return!1}}))}getById(t){return r(this,void 0,void 0,(function*(){try{const e=yield i.promises.readFile(this.archivo,"utf-8");return JSON.parse(e).find((e=>e.id==t))||!1}catch(t){return!1}}))}getAll(){return r(this,void 0,void 0,(function*(){try{const t=yield i.promises.readFile(this.archivo,"utf-8");return JSON.parse(t)}catch(t){return!1}}))}deleteById(t){return r(this,void 0,void 0,(function*(){try{const e=yield this.getById(t),o=(yield this.getAll()).filter((t=>t.id!=e.id));return yield i.promises.writeFile(this.archivo,JSON.stringify(o)),!!e}catch(t){return!1}}))}updateById(t,e){return r(this,void 0,void 0,(function*(){try{const o=yield this.getAll(),r=o.findIndex((e=>e.id==t));return r>=0&&(e.id=t,o.splice(r,1,e),yield i.promises.writeFile(this.archivo,JSON.stringify(o)),e)}catch(t){return!1}}))}}function d(t,e,o){o()}var c=function(t,e,o,r){return new(o||(o=Promise))((function(i,n){function s(t){try{c(r.next(t))}catch(t){n(t)}}function d(t){try{c(r.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(s,d)}c((r=r.apply(t,e||[])).next())}))};const a=(0,t.Router)(),u=new s("./archivos/productos.json");a.get("/",((t,e)=>c(void 0,void 0,void 0,(function*(){const t=yield u.getAll();t?e.json({status:"ok",message:"Lista de productos entregada correctamente",code:"200",products:t}):e.json({status:"nok",message:"No se pudo devolver la lista de productos",code:"400",products:null})})))),a.get("/:id",((t,e)=>c(void 0,void 0,void 0,(function*(){let o=parseInt(t.params.id);const r=yield u.getById(o);r?e.json({status:"ok",message:"Producto enviado correctamente",code:"200",product:r}):e.json({status:"nok",message:"Producto no encontrado",code:"400",product:null})})))),a.post("/",d,((t,e)=>c(void 0,void 0,void 0,(function*(){const o=t.body,r=yield u.save(o);r?e.json({status:"ok",message:"Producto guardado correctamente",code:"200",product:r}):e.json({status:"nok",message:"Error al guardar el producto",code:"400",product:null})})))),a.put("/:id",d,((t,e)=>c(void 0,void 0,void 0,(function*(){const o=t.body;let r=parseInt(t.params.id);const i=yield u.updateById(r,o);i?e.json({status:"ok",message:"Producto editado correctamente",code:"200",product:i}):e.json({status:"nok",message:"Error al editar el producto",code:"400",product:null})})))),a.delete("/:id",d,((t,e)=>c(void 0,void 0,void 0,(function*(){let o=parseInt(t.params.id);(yield u.deleteById(o))?e.json({status:"ok",message:"Producto Eliminado correctamente",code:"200"}):e.json({status:"nok",message:"Error al eliminar el producto",code:"400"})}))));const l=a;var p=function(t,e,o,r){return new(o||(o=Promise))((function(i,n){function s(t){try{c(r.next(t))}catch(t){n(t)}}function d(t){try{c(r.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(s,d)}c((r=r.apply(t,e||[])).next())}))};const v=o(147),{DefaultDeserializer:h}=o(655);var y=function(t,e,o,r){return new(o||(o=Promise))((function(i,n){function s(t){try{c(r.next(t))}catch(t){n(t)}}function d(t){try{c(r.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(s,d)}c((r=r.apply(t,e||[])).next())}))};const f=(0,t.Router)(),m=new class{constructor(t){this.archivo=t}save(){return p(this,void 0,void 0,(function*(){try{const t=yield this.getAll();let e;e=t.length?t.slice(-1)[0].id+1:1;const o={id:e,timestamp:Date.now(),productos:[]};return t.push(o),yield v.promises.writeFile(this.archivo,JSON.stringify(t)),o.id}catch(t){return!1}}))}getAll(){return p(this,void 0,void 0,(function*(){try{const t=yield v.promises.readFile(this.archivo,"utf-8");return JSON.parse(t)}catch(t){return!1}}))}getById(t){return p(this,void 0,void 0,(function*(){try{const e=yield v.promises.readFile(this.archivo,"utf-8");return JSON.parse(e).find((e=>e.id==t))||!1}catch(t){return!1}}))}deleteById(t){return p(this,void 0,void 0,(function*(){try{const e=yield this.getById(t),o=(yield this.getAll()).filter((t=>t.id!=e.id));return yield v.promises.writeFile(this.archivo,JSON.stringify(o)),!!e}catch(t){return!1}}))}getAllProductFromCart(t){return p(this,void 0,void 0,(function*(){try{return(yield this.getById(t)).productos||!1}catch(t){return!1}}))}saveProduct(t,e){return p(this,void 0,void 0,(function*(){try{const o=new s("./archivos/productos.json"),r=yield o.getById(e);if(r){const e=yield this.getAll(),o=e.findIndex((e=>e.id==t));return o>=0&&(e[o].productos.push(r),yield v.promises.writeFile(this.archivo,JSON.stringify(e))),!0}return!1}catch(t){return!1}}))}deleteProduct(t,e){return p(this,void 0,void 0,(function*(){try{const o=yield this.getAll(),r=o.findIndex((e=>e.id==t));if(r>=0){const t=o[r].productos.findIndex((t=>t.id==e));return t>=0&&(o[r].productos.splice(t,1),yield v.promises.writeFile(this.archivo,JSON.stringify(o))),!0}return!1}catch(t){return!1}}))}}("./archivos/shoppingCart.json");f.post("/",((t,e)=>y(void 0,void 0,void 0,(function*(){t.body;const o=yield m.save();o?e.json({status:"ok",message:"Carrito creado correctamente",code:"200",id:o}):e.json({status:"nok",message:"Error al crear el carrito",code:"400",id:null})})))),f.delete("/:id",((t,e)=>y(void 0,void 0,void 0,(function*(){let o=parseInt(t.params.id);(yield m.deleteById(o))?e.json({status:"ok",message:"El carrito fue Eliminado correctamente",code:"200"}):e.json({status:"nok",message:"Error al eliminar el carrito",code:"400"})})))),f.get("/:id/productos",((t,e)=>y(void 0,void 0,void 0,(function*(){let o=parseInt(t.params.id);const r=yield m.getAllProductFromCart(o);r?e.json({status:"ok",message:"Los productos del carrito se enviarÃ³n correctamente",code:"200",products:r}):e.json({status:"nok",message:"Error al enviar los productos del carrito",code:"400",products:null})})))),f.post("/:id/productos",((t,e)=>y(void 0,void 0,void 0,(function*(){let o=parseInt(t.params.id),r=parseInt(t.body.prod_id);(yield m.saveProduct(o,r))?e.json({status:"ok",message:"El producto se agrego correctamente al carrito",code:"200"}):e.json({status:"nok",message:"Error al agregar un producto al carrito",code:"400"})})))),f.delete("/:id/productos/:id_prod",((t,e)=>y(void 0,void 0,void 0,(function*(){let o=parseInt(t.params.id),r=parseInt(t.params.id_prod);(yield m.deleteProduct(o,r))?e.json({status:"ok",message:"El producto se elimino correctamente al carrito",code:"200"}):e.json({status:"nok",message:"Error al eliminar un producto al carrito",code:"400"})}))));const g=f,I=e()();I.use(e().json()),I.use(e().urlencoded({extended:!0})),I.use(e().static("public")),I.use("/api/productos",l),I.use("/api/carrito",g),I.use(((t,e)=>{const o={error:-2,descripcion:`ruta: ${t.url} metodo: ${t.method} no implementado`};e.status(404).json(o)}));const j=process.env.PORT||8080;I.listen(j,(()=>{console.log("Servidor corriendo en el puerto 8080")}))})()})();